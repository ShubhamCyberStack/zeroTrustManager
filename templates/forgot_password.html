{% extends "base.html" %}
{% block content %}

<style>
:root {
  --bg: #f4f6fb;
  --card: #fff;
  --card-shadow: rgba(44,62,80,0.08);
  --input-bg: #f7f9fc;
  --input-border: #d1d9e6;
  --button-bg: #2d72d9;
  --button-text: #fff;
  --text: #222;
}
body {
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
  background-color: var(--bg);
  color: var(--text);
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.3s ease;
}
.form-container {
  width: 100%;
  max-width: 420px;
  background: var(--card);
  border-radius: 18px;
  padding: 32px 24px 24px 24px;
  box-shadow: 0 4px 24px var(--card-shadow);
  border: 1px solid var(--input-border);
  box-sizing: border-box;
  text-align: center;
  margin: 32px 0;
}
h2 {
  font-size: 2rem;
  margin-bottom: 18px;
  font-weight: 700;
  letter-spacing: 0.5px;
}
input, select {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  border-radius: 8px;
  border: 1px solid var(--input-border);
  background-color: var(--input-bg);
  color: var(--text);
  font-size: 1rem;
  box-sizing: border-box;
  transition: border 0.2s;
}
input:focus, select:focus {
  border: 1.5px solid var(--button-bg);
  outline: none;
}
button {
  width: 100%;
  padding: 14px;
  font-size: 1rem;
  border-radius: 8px;
  border: none;
  background-color: var(--button-bg);
  color: var(--button-text);
  cursor: pointer;
  font-weight: 700;
  margin-top: 14px;
  margin-bottom: 4px;
  letter-spacing: 0.5px;
  transition: background 0.2s;
}
button:hover {
  background-color: #174ea6;
}
.password-wrapper {
  position: relative;
}
.password-wrapper input {
  padding-right: 44px;
}
.toggle-password {
  position: absolute;
  top: 50%;
  right: 14px;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 1.2rem;
  color: #888;
  user-select: none;
}
.switch-link {
  margin-top: 18px;
  font-size: 1rem;
}
.switch-link a {
  color: var(--button-bg);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}
.switch-link a:hover {
  color: #174ea6;
  text-decoration: underline;
}
@media (max-width: 600px) {
  .form-container {
    max-width: 98vw;
    padding: 18px 6vw 18px 6vw;
    margin: 0;
    border-radius: 10px;
  }
  h2 {
    font-size: 1.3rem;
  }
  input, select, button {
    font-size: 0.98rem;
    padding: 12px;
  }
}
@media (max-width: 400px) {
  .form-container {
    padding: 10px 2vw;
  }
  h2 {
    font-size: 1.1rem;
  }
}
</style>

<div class="form-container">
    <h2>üîê Reset Password</h2>

    {% if step == 1 %}
    <form method="POST">
        <input type="hidden" name="step" value="1">
        <input type="text" name="username" placeholder="Enter your username" required>
        <select name="security_question" required>
            <option value="">Select a security question</option>
            {% for key, question in questions.items() %}
                <option value="{{ key }}">{{ question }}</option>
            {% endfor %}
        </select>
        <input type="text" name="security_answer" placeholder="Enter your security answer" required>
        <button type="submit">Next ‚Üí</button>
    </form>
    {% elif step == 2 %}
    <form method="POST">
        <input type="hidden" name="step" value="2">
        <input type="text" name="otp" placeholder="Enter 6-digit OTP" maxlength="6" required>
        <button type="submit">Verify OTP ‚Üí</button>
    </form>
    {% elif step == 3 %}
    <form method="POST">
        <input type="hidden" name="step" value="3">
        <div class="password-wrapper">
            <input type="password" name="super_secret_key" id="super-secret-key" placeholder="Enter your Super Secret Key" required>
            <span class="toggle-password" onclick="togglePassword('super-secret-key')">üëÅÔ∏è</span>
        </div>
        <div class="password-wrapper">
            <input type="password" name="new_password" id="new-password" placeholder="Enter new strong password" required>
            <span class="toggle-password" onclick="togglePassword('new-password')">üëÅÔ∏è</span>
        </div>
        <button type="submit">Reset Password</button>
    </form>
    {% endif %}

    <div class="switch-link">
        <a href="/login">‚Üê Back to Login</a>
    </div>
</div>

<script>
function togglePassword(id) {
    const input = document.getElementById(id);
    if (input) input.type = (input.type === "password") ? "text" : "password";
}
</script>

{% endblock %}
