{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h2>üîì Unlock Vault</h2>
    <p>Enter your OTP to access your secure password vault</p>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="flash-messages">
                {% for message in messages %}
                    <div class="flash-message alert alert-info">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="POST" action="/unlock-vault">
        <div class="form-group">
            <label for="otp">Enter OTP from your authenticator app:</label>
            <input type="text" 
                   id="otp" 
                   name="otp" 
                   placeholder="123456" 
                   maxlength="6" 
                   pattern="[0-9]{6}" 
                   required 
                   autocomplete="one-time-code">
        </div>

        <button type="submit" class="btn-primary">
            üîì Unlock Vault
        </button>
    </form>

    <div class="switch-link" style="margin-top: 20px;">
        <a href="/logout">‚Üê Logout</a>
    </div>
</div>

<style>
.flash-messages {
    margin: 20px 0;
}

.flash-message {
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    background-color: #d1ecf1;
    border: 1px solid #bee5eb;
    color: #0c5460;
}

.alert-info {
    background-color: #d1ecf1;
    border-color: #bee5eb;
    color: #0c5460;
}

.form-group {
    margin-bottom: 15px;
    text-align: left;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--text);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    margin-top: 10px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

input[type="text"] {
    text-align: center;
    font-size: 1.2rem;
    letter-spacing: 2px;
}
</style>

<script>
// Auto-focus on OTP input
document.getElementById('otp').focus();

// Auto-submit when 6 digits are entered
document.getElementById('otp').addEventListener('input', function(e) {
    if (e.target.value.length === 6) {
        // Small delay to show the complete code
        setTimeout(() => {
            document.querySelector('form').submit();
        }, 300);
    }
});

// Only allow numbers
document.getElementById('otp').addEventListener('keypress', function(e) {
    if (!/[0-9]/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete') {
        e.preventDefault();
    }
});
</script>
{% endblock %}
